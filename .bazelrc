# Bazel Configuration for wasmsign2

# Enable bzlmod (Bazel module system)
common --enable_bzlmod

# Build configuration
build --incompatible_strict_action_env
build --host_force_python=PY3
build --action_env=BAZEL_DO_NOT_DETECT_CPP_TOOLCHAIN=1

# Enable platform-specific toolchain selection
build --incompatible_enable_cc_toolchain_resolution

# WebAssembly specific settings
build:wasm --platforms=@platforms//cpu:wasm32
build:wasm --incompatible_enable_cc_toolchain_resolution

# Rust WebAssembly builds (WASI Preview 2)
build:rust-wasm --config=wasm
build:rust-wasm --@rules_rust//rust/settings:experimental_use_cc_common_link=True

# Test configuration
test --test_output=errors
test --test_summary=detailed
test --test_verbose_timeout_warnings

# Coverage configuration
coverage --combined_report=lcov
coverage --coverage_report_generator=@bazel_tools//tools/test/CoverageOutputGenerator/java/com/google/devtools/coverageoutputgenerator:Main

# Performance optimizations
build --experimental_reuse_sandbox_directories
build --experimental_writable_outputs
build --experimental_inmemory_jdeps_files
build --experimental_inmemory_dotd_files

# Development settings
build:dev --compilation_mode=fastbuild
build:dev --strip=never
build:dev --copt=-O0
build:dev --copt=-g

# Release settings
build:release --compilation_mode=opt
build:release --strip=always
build:release --copt=-O3
build:release --copt=-DNDEBUG

# Security settings
build --incompatible_run_shell_command_string=false

# CI settings
build:ci --color=no
build:ci --curses=no
build:ci --show_timestamps
build:ci --verbose_failures
build:ci --test_output=errors

try-import %workspace%/.bazelrc.local
